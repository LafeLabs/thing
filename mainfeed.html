<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <!--

    EVERYTHING REPLICATES
    EVERYTHING EVOLVES
    EVERYTHING DIES
    
    -->
<link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAOADAADv+wAA7/sAAO/7AADv+wAA7/sAAO/7AADv+wAA77sAAO/fAADv7QAA4DUAAP/5AAD/4QAA" rel="icon" type="image/x-icon" />

    <!--Stop Google:-->
    <META NAME="robots" CONTENT="noindex,nofollow">

    <script src="jscode/geometron.js"></script>
    
</head>
<body>    
<div id = "header">
    <a id = "homelink" href = "index.html">
        <img src = "iconsymbols/home.svg" a/>
    </a>
    <a id = "maplink" href = "mapeditor.html">
        <img src = "iconsymbols/map.svg" alt = "map editor"/>
    </a>    
    <table id = "controltable">
        <tr>
            <td class = "button" id = "prevbutton">PREV</td>
            <td class = "button" id = "nextbutton">NEXT</td>
        </tr>
        <tr>
            <td>text:</td>
            <td>
                <input id = "textinput"/>
            </td>
        </tr>
        <tr>
            <td>link:</td>
            <td>
                <input id = "hrefinput"/>
            </td>
        </tr>
        <tr>
            <td>image url:</td>
            <td>
                <input id = "srcinput"/>
            </td>
        </tr>
        <tr>
            <td>glyph code:</td>
            <td>
                <input id = "glyphinput"/>
            </td>
        </tr>
        <tr>
            <td class = "button" id = "clearbutton">CLEAR</td>
            <td id = "publishbutton" class = "button">
                    PUBLISH
            </td>
        </tr>
    </table>
</div>

<div id = "feed"></div>

<script>

linkindex = 0;

document.getElementById("textinput").value = "";
document.getElementById("srcinput").value = "";
document.getElementById("hrefinput").value = "";
document.getElementById("glyphinput").value = "";

document.getElementById("clearbutton").onclick = function(){

    document.getElementById("textinput").value = "";
    document.getElementById("srcinput").value = "";
    document.getElementById("hrefinput").value = "";
    document.getElementById("glyphinput").value = "";

}

feedwidth = innerWidth;

if(innerWidth > innerHeight){
    feedwidth = innerHeight;    
    document.getElementById("feed").style.top = "0px";
    document.getElementById("header").style.width = (innerWidth - innerHeight).toString() + "px";    
    
    document.getElementById("feed").style.height = (innerHeight).toString() + "px";        
    document.getElementById("feed").style.width = (innerHeight).toString() + "px";
    
}
else{
    document.getElementById("feed").style.top = "150px";
    document.getElementById("header").style.width = (innerWidth).toString() + "px";    

    document.getElementById("feed").style.height = (innerHeight - 140).toString() + "px";            
    document.getElementById("feed").style.width = (innerWidth).toString() + "px";                
}

document.getElementById("feed").style.width = feedwidth.toString() + "px";


feed = [];


function loadfeedurl(url){
    document.getElementById("feed").innerHTML = "";

    var httpc666 = new XMLHttpRequest();
    httpc666.onreadystatechange = function(){
        if (this.readyState == 4 && this.status == 200) {
            feed = JSON.parse(this.responseText);
            loadfeed();
        }
    };
    httpc666.open("GET", "fileloader.php?filename=" + url, true);
    httpc666.send();
}

function loadfeed(){
    document.getElementById("feed").innerHTML = "";
    for(var index = 0;index < feed.length;index++){
        var newdiv = document.createElement("DIV");
        document.getElementById("feed").appendChild(newdiv);
        newdiv.id = "d" + index.toString();
        newdiv.className = "feedelement";
        newdiv.style.marginTop = "3em";
        var newimage = document.createElement("IMG");
        newdiv.appendChild(newimage);
        newimage.src = "iconsymbols/upelement.svg";
        newimage.classList.add("upbutton");

        newimage.onclick = function(){
            //move element to start
            linkindex = parseInt(this.parentElement.id.substring(1));
            
            if(linkindex != 0){
                var thiselement = feed[linkindex];
                var tempfeed = [];
                for(var index = 0;index < feed.length;index++){
                    if(index != linkindex){
                        tempfeed.push(feed[index]);
                    }
                }
                feed = tempfeed;
                feed.unshift(thiselement);
                loadfeed();
                savefeed();

            }
        }

        var newimage2 = document.createElement("IMG");
        newdiv.appendChild(newimage2);
        newimage2.src = "iconsymbols/delete.svg";
      //  newimage.style.width = 0.2*feedwidth.toString()  + "px";

        newimage2.classList.add("button");
        newimage2.classList.add("deletebutton");


        newimage2.onclick = function(){
            //delete element
            linkindex = parseInt(this.parentElement.id.substring(1));
            
            var tempfeed = [];
            for(var index = 0;index < feed.length;index++){
                if(index != linkindex){
                    tempfeed.push(feed[index]);
                }
            }
            feed = tempfeed;
            loadfeed();
            savefeed();
            
        }
        
        var newa = document.createElement("A");
        newa.className = "linka";
        if(feed[index].href.length > 0){
            newa.href = feed[index].href;
        }
        newa.innerHTML = feed[index].text;
        newdiv.appendChild(newa);
    
        if(feed[index].glyph.length > 0){
            
            var newspan = document.createElement("SPAN");
            newspan.className = "canbox";
    
            newdiv.appendChild(newspan);
            var newcan = document.createElement("CANVAS");
            newspan.appendChild(newcan);
            var newGVM = new GVM(newcan,200,200);
            newGVM.unit = 20;
            newGVM.x0 = 100;
            newGVM.y0 = 100;
            newGVM.importbytecode(hypercube);
            newGVM.action(0300);
            newGVM.drawGlyph(feed[index].glyph);
        }

        if(feed[index].src.length > 0){
            
            var newimg = document.createElement("IMG");
            newimg.className = "feedimage";

            newimg.src = feed[index].src;
            newimg.alt = feed[index].text;
            newdiv.appendChild(newimg);
            newimg.onload = function(){
                this.parentElement.style.height = (this.height + 200).toString() + "px";
                    

            }
            newimg.className = "elementimage";
        }
        
        if(feed[index].src.length == 0 && feed[index].glyph.length == 0){
            newdiv.style.height = "200px";
        }
        
    }

}


document.getElementById("publishbutton").onclick = function(){
    
    var newelement = {};
    
    
    newelement.text = document.getElementById("textinput").value;
    newelement.src = document.getElementById("srcinput").value;
    newelement.href = document.getElementById("hrefinput").value;
    newelement.glyph = document.getElementById("glyphinput").value;

    feed.unshift(newelement);
    loadfeed();
    savefeed();
    
}


function savefeed(){
    
    var httpc = new XMLHttpRequest();
    httpc.open("POST", "filesaver.php", true);
    httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpc.send("data="+encodeURIComponent(JSON.stringify(feed,null,"  "))+"&filename=data/mainfeed.txt");//send text to filesaver.php   

}


hypercube = [];
var httpcHypercube = new XMLHttpRequest();
httpcHypercube.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
        hypercube = JSON.parse(this.responseText);
        loadfeedurl("data/mainfeed.txt");        
    }
};
httpcHypercube.open("GET", "fileloader.php?filename=data/hypercube.txt", true);
httpcHypercube.send();


document.getElementById("nextbutton").onclick = function(){
    linkindex++;
    if(linkindex > feed.length){
        linkindex = 0;
    }
    document.getElementById("textinput").value = feed[linkindex].text;
    document.getElementById("srcinput").value = feed[linkindex].src;
    document.getElementById("hrefinput").value = feed[linkindex].href;
    document.getElementById("glyphinput").value = feed[linkindex].glyph;
    
    
}


document.getElementById("prevbutton").onclick = function(){
    linkindex--;
    if(linkindex < 0){
        linkindex = feed.length - 1;
    }
    document.getElementById("textinput").value = feed[linkindex].text;
    document.getElementById("srcinput").value = feed[linkindex].src;
    document.getElementById("hrefinput").value = feed[linkindex].href;
    document.getElementById("glyphinput").value = feed[linkindex].glyph;

}

</script>
<style>
body{
    overflow:hidden;
}
#controltable{
    
}
.deletebutton{

    
}
.upbutton{
    
}
.elementimage{
    right:310px;
    max-width:50%;
    margin:auto;
    display:block;
}
.canbox{
    border:solid;
    display:block;
    margin:auto;
}
.linka{
    font-size:2em;
}
#header{
    height:150px;
    position:absolute;
    top:0px;
    right:0px;
    background-color:#ff808080;
    font-family:courier;
    font-size:14px;
}
#feed{
    position:absolute;
    left:0px;
    background-color:#80808080;
    overflow:scroll;
}
.feedelement{
    height:400px;
    border:solid;
    background-color:white;
    width:90%;
    margin:auto;
    overflow:scroll;
}
#homelink{
    position:absolute;
    right:0px;
    top:0px;
}
#homelink img{
    width:50px;
}
#maplink{
    position:absolute;
    right:60px;
    top:0px;
}
#maplink img{
    width:50px;
}
.button{
    cursor:pointer;
    border:solid;
    border-radius:5px;
    text-align:center;
}
.button:hover{
    background-color:green;
}
.button:active{
    background-color:yellow;
}
@media only screen and (orientation: landscape) {

    
}

@media only screen and (orientation: portrait) {
    
    
    
}
</style>
</body>
</html>
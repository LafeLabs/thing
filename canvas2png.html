<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
</head>
<body>   
    <a href = "mapeditor.html">
        <img style = "width:50px;" src = "iconsymbols/map.svg"/>
    </a>        

<h1>canvas to png</h2>

<!--
<img id = "mainimage" src = "https://i.imgur.com/sEkTrFV.jpg"/>
-->


<img id = "mainimage" src = "uploadimages/image1.PNG"/>


<canvas id = "maincanvas"></canvas>
<table>
    <tr>
        <td>Image URL:</td>
        <td><input id = "imageurl"/></td>
    </tr>
    <tr>
        <td>RAW png code:</td>
        <td><input id = "rawinput"/></td>
    </tr>
</table>
<div id  = "imagescroll">
    
</div>
<script>
foo = "";
document.getElementById("mainimage").onload = function() {
    canvas = document.getElementById("maincanvas");
    ctx = canvas.getContext("2d");
    canvas.width = this.width;
    canvas.height = this.height;
    img = document.getElementById("mainimage");
    img.crossOrigin = 'Anonymous';
  
    ctx.drawImage(img, 0,0,this.width,this.height);
    document.getElementById("rawinput").value = canvas.toDataURL();
//    foo = canvas.toDataURL('image/jpeg', 0.1);
    
};



upuploadImages = [];
var httpc9 = new XMLHttpRequest();
    httpc9.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        upuploadImages = JSON.parse(this.responseText);
        for(var index = upuploadImages.length - 1;index >= 0;index--) {
            var newimg = document.createElement("IMG");
            newimg.src = "../uploadimages/" + upuploadImages[index];
            newimg.classList.add("uploadimage");
            newimg.classList.add("button");
            document.getElementById("imagescroll").appendChild(newimg);
            newimg.onclick = function() {
                var localurl = "uploadimages" + this.src.split("uploadimages")[1];
                document.getElementById("imageurl").value = localurl;
                document.getElementById("mainimage").src = localurl;
            }

        }
    }
};

httpc9.open("GET", "dir.php?filename=uploadimages", true);
httpc9.send();

</script>
<style>
#mainimage{
    width:400px;
}
#imagescroll{
    position:absolute;
    right:0px;
    top:0px;
    overflow:scroll;
    width:300px;
}
#imagescroll img{
    max-width:50%;
    display:block;
    margin:auto;
    margin-top:1em;
}
</style>
</body>
</html>
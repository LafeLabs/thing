<!doctype html>
<html lang="en">    
<head>
     <meta charset="utf-8"/>

    <!--Stop Google:-->
    <META NAME="robots" CONTENT="noindex,nofollow">

    <script src="jscode/geometron.js"></script>

<!--
    this is how shape table editor should be, totally focused on 3 rows, with symbols in a tablet that is automatically saved
-->
</head>
<body> 
<div id = "keyboardbox">
    <canvas id = "keyboard"></canvas>
</div>

    <table id = "iotable">
        <tr>
            <td>key</td><td><input id = "keyinput"/></td>
        </tr>
        <tr>
            <td>keycode</td><td><input id = "keycodeinput"/></td>
        </tr>
        <tr>
            <td>action</td><td><input id = "actioninput"/></td>
        </tr>
    </table>

<p><a href  = "index.html">index.html</a></p>

<textarea id = "textio"></textarea>
<script>

keyglypharray = [
    "0331,0333,0337,0200,0316,0336,0314,0336,0330,0332,0337,0313,0337,0332,",
    "0330,0332,0336,0314,0336,0330,0337,0314,0313,0337,",
    "0332,0333,0331,0336,0314,0336,0331,0333,0331,0314,0337,0316,0337,0332,0313,0336,0336,0330,0333,0336,0331,0332,0337,",
    "0365,0330,0330,",
    "0365,0331,0331,0333,0333,0333,0336,0331,0333,0337,0337,0330,0332,",
    "0333,0333,0336,0336,0333,0337,0337,"
];


lc = ["`1234567890-=","qwertyuiop[]\\","asdfghjkl;\'","zxcvbnm,./"];
uc = ["~!@#$%^&*()_+","QWERTYUIOP{}|","ASDFGHJKL:\"","ZXCVBNM<>?"];


currentKeyCode = 0141;

var mainGVM = new GVM(document.getElementById("keyboard"),1200,370);
mainGVM.x0 = 50;
mainGVM.y0 = 55;
mainGVM.unit = 37;


var httpc = new XMLHttpRequest();
httpc.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
        var localhypercube = JSON.parse(this.responseText);
        mainGVM.importbytecode(localhypercube);
        redraw();
    }
};
httpc.open("GET", "fileloader.php?filename=data/hypercube.txt", true);
httpc.send();


function redraw(){
    mainGVM.drawGlyph("0300,");
    for(var row = 0;row < lc.length;row++){
        for(var col = 0;col < lc[row].length;col++){
            upperkey = "0" + (uc[row].charCodeAt(col)).toString(8);
            lowerkey = "0" + (lc[row].charCodeAt(col)).toString(8);
        
            uppersymbol = "0" + (parseInt(mainGVM.hypercube[uc[row].charCodeAt(col)],8)+01000).toString(8);
            lowersymbol = (parseInt(mainGVM.hypercube[lc[row].charCodeAt(col)],8)+01000).toString(8);

            //console.log(upperkey + "," + lowerkey + "," + uppersymbol + "," + uppersymbol + ",");
            
            mainGVM.actionSequence(keyglypharray[0] + lowersymbol + "," + keyglypharray[1] + uppersymbol + "," + keyglypharray[2] + lowerkey + "," + keyglypharray[3] + upperkey + "," + keyglypharray[4] + keyglypharray[5]);
        }
        if(row == 0){
            mainGVM.actionSequence("0331,0331,0336,0336,0331,0337,0337,0336,0332,0337,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,");
        }
        if(row == 1){
            mainGVM.actionSequence("0331,0331,0336,0336,0331,0337,0337,0336,0332,0332,0332,0337,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,");
        }        
        if(row == 2){
            mainGVM.actionSequence("0331,0331,0336,0336,0331,0337,0337,0336,0332,0332,0332,0337,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,0332,");            
        }
    }
}


document.getElementById("keyinput").value = "";
document.getElementById("keyinput").select();
document.getElementById("keyinput").onkeypress = function(a) {
    currentKeyCode = a.keyCode || a.which;
    document.getElementById("keyinput").value = "";
    document.getElementById("keycodeinput").value = "0" + currentKeyCode.toString(8);
    document.getElementById("actioninput").value = mainGVM.hypercube[currentKeyCode].split(",")[0];
}
document.getElementById("actioninput").onchange = function(){
    mainGVM.hypercube[currentKeyCode] = this.value;
    redraw();
    savekeyboard();
}

function savekeyboard(){
    
    var httpc = new XMLHttpRequest();
    httpc.open("POST", "filesaver.php", true);
    httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpc.send("data=" + encodeURIComponent(mainGVM.bytecode(0,01777))+"&filename=data/hypercube.txt");//send text to filesaver.php
    document.getElementById("textio").value = mainGVM.bytecode(040,0177);

}
</script>
<style>
.button{
    cursor:pointer;
}
.button:hover{
    background-color: green;
}
.button:active{
    background-color: yellow;
}
tr{
    text-align:right;
}
table{
    border:solid;
    width:50px;
    height:50px;
}
canvas{

border:solid;
}
#symbolbox{
    position:absolute;
    right:0px;
    top:0px;
    background-color:#ffafaf;
}
#keybox{
    font-size:5em;
}
#buttontable{
    border:none;
}
#buttontable .button{
    border:solid;
    text-align:center;
}
#iotable{
    position:absolute;
    left:0px;
    bottom:0px;
}
</style>
</body>
</html>